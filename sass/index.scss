// Homepage — bento grid layout

// Vertically center the grid in the available viewport space
// Subtract the sticky header height and #main-content block padding
.bento-wrap {
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-height: calc(100dvh - 52px - 6rem);
}

.bento {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.625rem;

  grid-template-areas:
    "hero      hero      hero      latest  latest"
    "playing   playing   clock     clock   clock";

  // First row stretches (hero + latest fill equally), second row hugs content
  grid-template-rows: 1fr auto;
}

.bento-cell {
  min-width: 0;
  transition: box-shadow var(--transition), transform var(--transition-bezier);
}

// Cell label — shared pattern for card headers
.cell-label {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  font-size: var(--font-size-xx-small);
  font-weight: var(--font-weight-semi-bold);
  color: var(--accent-color);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-block-end: 0.5rem;

  .icon {
    font-size: 0.875rem;
  }
}

// --- Hero card ---
.hero {
  grid-area: hero;
  display: flex;
  align-items: center;
  gap: 1.25rem;
  padding: 1.5rem;

  .hero-avatar {
    width: 6rem;
    height: 6rem;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: var(--edge-highlight), var(--shadow);
    object-fit: cover;
    margin: 0;
  }

  .hero-body {
    min-width: 0;

    .buttons {
      margin-block-start: 0.75rem;
    }
  }

  .hero-title {
    margin: 0;
    font-size: var(--font-size-xx-large);
    line-height: 1.2;
  }

  .hero-tagline {
    margin: 0.25rem 0 0;
    font-size: var(--font-size-small);
    color: var(--fg-muted-1);
    line-height: 1.5;
  }
}

// --- Latest post card (ametrine-inspired: accent bg + blurnail tint + banner peek) ---
.latest-post {
  grid-area: latest;
  display: flex;
  flex-direction: column;
  text-decoration: none;
  overflow: hidden;
  border-radius: var(--rounded-corner);
  box-shadow: var(--edge-highlight), var(--shadow);

  // Accent background tinted with blurred thumbnail (same as ametrine article cards)
  background-image: var(--bg-overlay), var(--blurnail);
  background-position: center;
  background-size: cover;
  background-color: var(--bg-muted-1);

  // Accent color scoping (uses the --accent-light/dark-h/s/l vars set inline)
  --accent-color: hsl(var(--accent-light-h), var(--accent-light-s), var(--accent-light-l));

  @media (prefers-color-scheme: dark) {
    --accent-color: hsl(var(--accent-dark-h), var(--accent-dark-s), var(--accent-dark-l));
  }

  color: var(--fg-color);

  &:hover {
    box-shadow: var(--edge-highlight), var(--shadow-raised);
    transform: translateY(-0.125rem);

    .latest-post-banner {
      &::before {
        background-color: var(--shade-color);
      }

      img {
        transform: scale(1.1);
        filter: blur(0.25rem);
      }
    }

    .latest-post-title .icon {
      opacity: 1;
    }
  }

  .cell-label {
    color: var(--accent-color);
  }

  .latest-post-body {
    padding: 1rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .latest-post-title {
    font-size: var(--font-size-normal);
    font-weight: var(--font-weight-semi-bold);
    line-height: 1.3;
    color: var(--accent-color);

    .icon {
      opacity: 0;
      vertical-align: middle;
      transition: opacity var(--transition);
    }
  }

  .latest-post-desc {
    margin: 0.375rem 0 0;
    font-size: var(--font-size-x-small);
    color: var(--fg-muted-1);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .latest-post-date {
    margin-block-start: auto;
    padding-block-start: 0.5rem;
    font-size: var(--font-size-xx-small);
    color: var(--fg-muted-2);
  }

  // Banner peek at the bottom — fades from top into the card bg
  .latest-post-banner {
    position: relative;
    height: 6.5rem;
    overflow: hidden;
    flex-shrink: 0;

    // Easing mask: smooth fade spanning most of the banner height
    --mask-image: linear-gradient(
      to bottom,
      hsla(0, 0%, 0%, 0) 0%,
      hsla(0, 0%, 0%, 0.15) 20%,
      hsla(0, 0%, 0%, 0.4) 40%,
      hsla(0, 0%, 0%, 0.7) 60%,
      hsl(0, 0%, 0%) 80%
    );
    mask-image: var(--mask-image);
    -webkit-mask-image: var(--mask-image);

    // Shade overlay (same as ametrine article cards)
    &::before {
      content: "";
      position: absolute;
      inset: 0;
      z-index: 1;
      border-radius: inherit;
      transition: background-color var(--transition);
    }

    img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top;
      margin: 0;
      transition: transform var(--transition), filter var(--transition);
      max-width: none;
      max-height: none;
      border-radius: 0;
      box-shadow: none;
    }
  }
}

// --- Now Playing card ---
.now-playing {
  grid-area: playing;
  position: relative;
  overflow: hidden;

  background-color: var(--bg-muted-1);

  // Blurnail color wash — heavily blurred so only the dominant color bleeds through
  &::before {
    content: "";
    position: absolute;
    inset: -2rem;
    background-image: var(--blurnail);
    background-position: center;
    background-size: cover;
    filter: blur(2rem) saturate(2);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  // Staggered reveal when JS loads the track
  &.is-loaded {
    &::before {
      opacity: 0.45;

      @media (prefers-color-scheme: dark) {
        opacity: 0.35;
      }
    }

    .now-playing-cover {
      opacity: 1;
    }

    .cell-label {
      opacity: 1;
      transform: none;
    }

    .now-playing-track {
      opacity: 1;
      transform: none;
    }

    .now-playing-artist {
      opacity: 1;
      transform: none;
    }
  }

  // Cover artwork — positioned right, fading out to the left
  .now-playing-cover {
    opacity: 0;
    transition: opacity 0.4s ease;
    position: absolute;
    inset: 0;
    left: auto;
    width: 60%;
    overflow: hidden;

    --mask: linear-gradient(
      to left,
      hsl(0, 0%, 0%) 0%,
      hsla(0, 0%, 0%, 0.8) 15%,
      hsla(0, 0%, 0%, 0.5) 35%,
      hsla(0, 0%, 0%, 0.2) 55%,
      hsla(0, 0%, 0%, 0) 70%
    );
    mask-image: var(--mask);
    -webkit-mask-image: var(--mask);

    img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: right;
      margin: 0;
      max-width: none;
      max-height: none;
      border-radius: 0;
      box-shadow: none;
    }
  }

  .now-playing-body {
    position: relative;
    z-index: 1;
    min-width: 0;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .cell-label {
    opacity: 0;
    transform: translateX(0.5rem);
    transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
  }

  .now-playing-info {
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .now-playing-track {
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-semi-bold);
    color: var(--fg-color);
    line-height: 1.3;
    opacity: 0;
    transform: translateX(0.5rem);
    transition: opacity 0.3s ease 0.2s, transform 0.3s ease 0.2s;
  }

  .now-playing-artist {
    font-size: var(--font-size-x-small);
    color: var(--fg-muted-1);
    opacity: 0;
    transform: translateX(0.5rem);
    transition: opacity 0.3s ease 0.3s, transform 0.3s ease 0.3s;
  }
}

// --- Clock + Weather card ---
.clock-card {
  grid-area: clock;
  display: flex;
  flex-direction: column;
  align-items: flex-start;

  // Animated weather backgrounds (from ametrine, scaled up for wider card)
  // Override .card's opaque background so the tiling texture is visible
  // background-color fades to transparent, revealing the background-image behind it
  transition: background-color 0.5s ease;

  &.cloudy,
  &.showers,
  &.snowing {
    background-color: transparent;
    background-size: 512px;
      }

  &.cloudy {
    animation: perlin 30s linear infinite;
    background-image: url("/weather/perlin.png");

    @media (prefers-color-scheme: dark) {
      background-image: url("/weather/perlin-dark.png");
    }
  }

  &.showers {
    animation: rain 8s linear infinite;
    background-image: url("/weather/rain.svg");
    background-size: 512px 640px;

    @media (prefers-color-scheme: dark) {
      background-image: url("/weather/rain-dark.svg");
    }
  }

  &.snowing {
    animation: snow 30s linear infinite;
    background-image: url("/weather/snow.svg");

    @media (prefers-color-scheme: dark) {
      background-image: url("/weather/snow-dark.svg");
    }
  }

  @keyframes rain {
    to { background-position: 512px 640px; }
  }

  @keyframes perlin {
    to { background-position: -512px -128px; }
  }

  @keyframes snow {
    to { background-position: 1024px; }
  }

  // Horizontal layout: clock left, weather right
  .clock-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex: 1;
    width: 100%;
    gap: 1rem;
  }

  .clock-side {
    display: flex;
    flex-direction: column;
  }

  .clock-display {
    display: flex;
    align-items: baseline;
    gap: 0.125rem;
    font-family: var(--font-monospace), var(--font-ui-monospace);
    font-size: var(--font-size-xx-large);
    font-weight: var(--font-weight-bold);
    font-variant-numeric: tabular-nums;
    color: var(--fg-muted-1);
    line-height: 1;
  }

  .clock-separator {
    animation: clock-fade 2s ease-in-out infinite;
  }

  @keyframes clock-fade {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  .clock-greeting {
    margin-block-start: 0.375rem;
    font-size: var(--font-size-x-small);
    color: var(--fg-muted-1);
    font-style: italic;
  }

  .weather-side {
    display: flex;
    flex-direction: column;
    align-items: flex-end;

    .weather-main {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .weather-icon-wrap {
      display: flex;

      .icon {
        box-shadow: var(--edge-highlight);
        border-radius: 50%;
        background-color: var(--bg-muted-1);
        padding: 0.375rem;
        font-size: 1rem;
      }
    }

    .weather-temp {
      font-size: var(--font-size-xx-large);
      font-weight: var(--font-weight-bold);
      color: var(--fg-muted-1);
      line-height: 1;
    }

    .weather-condition {
      margin-block-start: 0.25rem;
      font-size: var(--font-size-x-small);
      color: var(--fg-muted-2);
    }
  }

  .clock-meta {
    font-size: var(--font-size-xx-small);
    color: var(--fg-muted-2);
    font-variant-numeric: tabular-nums;
  }
}

// --- Responsive ---
@media (max-width: 768px) {
  .bento {
    grid-template-columns: repeat(2, 1fr);
    grid-template-areas:
      "hero     hero"
      "latest   latest"
      "playing  clock";
  }
}

@media (max-width: 600px) {
  .bento {
    grid-template-columns: 2fr 3fr;
    grid-template-areas:
      "hero     hero"
      "latest   latest"
      "playing  clock";
  }
}

@media (max-width: 480px) {
  .bento {
    grid-template-columns: 1fr;
    grid-template-areas:
      "hero"
      "latest"
      "playing"
      "clock";
  }

  .hero {
    flex-direction: column;
    text-align: center;
    gap: 0.75rem;

    .hero-body .buttons {
      justify-content: center;
    }
  }

  .latest-post {
    flex-direction: column-reverse;

    .latest-post-banner {
      height: 9rem;

      // Flip mask: fade from bottom (banner is now on top)
      --mask-image: linear-gradient(
        to top,
        hsla(0, 0%, 0%, 0) 0%,
        hsla(0, 0%, 0%, 0.15) 20%,
        hsla(0, 0%, 0%, 0.4) 40%,
        hsla(0, 0%, 0%, 0.7) 60%,
        hsl(0, 0%, 0%) 80%
      );

      img {
        object-position: center;
      }
    }

    .latest-post-body {
      margin-block-start: -1rem;
    }

    .latest-post-title .icon {
      opacity: 1;
    }
  }

  .now-playing .now-playing-cover {
    width: 40%;
  }
}
